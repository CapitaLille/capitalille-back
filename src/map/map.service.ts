import { Injectable } from '@nestjs/common';
import { CreateMapDto } from './dto/create-map.dto';
import { UpdateMapDto } from './dto/update-map.dto';
import { InjectModel } from '@nestjs/mongoose';
import { CaseEvent, CaseEventType, CaseType, Map } from './map.schema';
import mongoose, { Model } from 'mongoose';
import { Doc } from 'src/server/server.type';
import { Player } from 'src/player/player.schema';

@Injectable()
export class MapService {
  constructor(@InjectModel('Map') private readonly mapModel: Model<Map>) {}

  async create(createMapDto: CreateMapDto) {
    return await this.mapModel.create(createMapDto);
  }

  async createFake() {
    const map = {
      cases: [
        {
          name: 'Bone',
          suivant: ['Bone.001', 'Bone.080'],
          precedent: [66],
          id: 0,
          coordinates: [505.6371765136719, 701.0],
          tail: [505.6371765136719],
          last: [66],
          next: [1, 77],
          type: 'start',
        },
        {
          name: 'Bone.001',
          suivant: ['Bone.002'],
          precedent: ['Bone'],
          id: 1,
          coordinates: [364.2371826171875, 605.9000244140625],
          tail: [364.2371826171875],
          last: [0],
          next: [2],
          type: 'house',
        },
        {
          name: 'Bone.002',
          suivant: ['Bone.003'],
          precedent: ['Bone.001'],
          id: 2,
          coordinates: [324.6371765136719, 697.4000854492188],
          tail: [324.6371765136719],
          last: [1],
          next: [3],
          type: 'monuments',
        },
        {
          name: 'Bone.003',
          suivant: ['Bone.004'],
          precedent: ['Bone.002'],
          id: 3,
          coordinates: [244.63719177246094, 754.0],
          tail: [244.63719177246094],
          last: [2],
          next: [4],
          type: 'house',
        },
        {
          name: 'Bone.004',
          suivant: ['Bone.005'],
          precedent: ['Bone.003'],
          id: 4,
          coordinates: [186.63720703125, 805.0],
          tail: [186.63720703125],
          last: [3],
          next: [5],
          type: 'house',
        },
        {
          name: 'Bone.005',
          suivant: ['Bone.006'],
          precedent: ['Bone.004'],
          id: 5,
          coordinates: [161.63720703125, 828.400146484375],
          tail: [161.63720703125],
          last: [4, 97],
          next: [6],
          type: 'intersection',
        },
        {
          name: 'Bone.006',
          suivant: ['Bone.007'],
          precedent: ['Bone.005'],
          id: 6,
          coordinates: [108.63720703125, 778.0],
          tail: [108.63720703125],
          last: [5],
          next: [7],
          type: 'house',
        },
        {
          name: 'Bone.007',
          suivant: ['Bone.008', 'Bone.019'],
          precedent: ['Bone.006'],
          id: 7,
          coordinates: [40.63723373413086, 730.0000610351562],
          tail: [40.63723373413086],
          last: [6],
          next: [8, 75],
          type: 'intersection',
        },
        {
          name: 'Bone.008',
          suivant: ['Bone.009'],
          precedent: ['Bone.007'],
          id: 8,
          coordinates: [56.13721466064453, 695.300048828125],
          tail: [56.13721466064453],
          last: [7],
          next: [9],
          type: 'house',
        },
        {
          name: 'Bone.009',
          suivant: ['Bone.010'],
          precedent: ['Bone.008'],
          id: 9,
          coordinates: [26.637203216552734, 662.0000610351562],
          tail: [26.637203216552734],
          last: [8],
          next: [10],
          type: 'house',
        },
        {
          name: 'Bone.010',
          suivant: ['Bone.011'],
          precedent: ['Bone.009'],
          id: 10,
          coordinates: [-12.362800598144531, 640.0000610351562],
          tail: [-12.362800598144531],
          last: [9],
          next: [11],
          type: 'event',
        },
        {
          name: 'Bone.011',
          suivant: ['Bone.012'],
          precedent: ['Bone.010'],
          id: 11,
          coordinates: [-51.36280059814453, 631.0000610351562],
          tail: [-51.36280059814453],
          last: [10],
          next: [12],
          type: 'monuments',
        },
        {
          name: 'Bone.012',
          suivant: ['Bone.013'],
          precedent: ['Bone.011'],
          id: 12,
          coordinates: [-95.36279296875, 711.0001220703125],
          tail: [-95.36279296875],
          last: [11],
          next: [13],
          type: 'event',
        },
        {
          name: 'Bone.013',
          suivant: ['Bone.014'],
          precedent: ['Bone.012'],
          id: 13,
          coordinates: [-136.36280822753906, 794.0],
          tail: [-136.36280822753906],
          last: [12],
          next: [14],
          type: 'house',
        },
        {
          name: 'Bone.014',
          suivant: ['Bone.015'],
          precedent: ['Bone.013'],
          id: 14,
          coordinates: [-180.36277770996094, 882.0],
          tail: [-180.36277770996094],
          last: [13],
          next: [15],
          type: 'event',
        },
        {
          name: 'Bone.015',
          suivant: ['Bone.016'],
          precedent: ['Bone.014'],
          id: 15,
          coordinates: [-202.36279296875, 928.0000610351562],
          tail: [-202.36279296875],
          last: [14],
          next: [16],
          type: 'house',
        },
        {
          name: 'Bone.016',
          suivant: ['Bone.017'],
          precedent: ['Bone.015'],
          id: 16,
          coordinates: [-222.36282348632812, 971.0000610351562],
          tail: [-222.36282348632812],
          last: [15],
          next: [17],
          type: 'event',
        },
        {
          name: 'Bone.017',
          suivant: ['Bone.018'],
          precedent: ['Bone.016'],
          id: 17,
          coordinates: [-166.36280822753906, 1007.0001220703125],
          tail: [-166.36280822753906],
          last: [16],
          next: [18],
          type: 'house',
        },
        {
          name: 'Bone.018',
          suivant: ['Bone.020', 'Bone.021'],
          precedent: ['Bone.017'],
          id: 18,
          coordinates: [-102.36279296875, 1043.0001220703125],
          tail: [-102.36279296875],
          last: [17, 76],
          next: [19, 73],
          type: 'intersection',
        },
        {
          name: 'Bone.020',
          suivant: ['Bone.022'],
          precedent: ['Bone.018'],
          id: 19,
          coordinates: [-129.36279296875, 1100.0001220703125],
          tail: [-129.36279296875],
          last: [18],
          next: [20],
          type: 'house',
        },
        {
          name: 'Bone.022',
          suivant: ['Bone.023'],
          precedent: ['Bone.020'],
          id: 20,
          coordinates: [-155.36279296875, 1153.0001220703125],
          tail: [-155.36279296875],
          last: [19],
          next: [21],
          type: 'event',
        },
        {
          name: 'Bone.023',
          suivant: ['Bone.024'],
          precedent: ['Bone.022'],
          id: 21,
          coordinates: [-178.36280822753906, 1203.0001220703125],
          tail: [-178.36280822753906],
          last: [20],
          next: [22],
          type: 'house',
        },
        {
          name: 'Bone.024',
          suivant: ['Bone.025'],
          precedent: ['Bone.023'],
          id: 22,
          coordinates: [-224.36279296875, 1302.0001220703125],
          tail: [-224.36279296875],
          last: [21],
          next: [23],
          type: 'house',
        },
        {
          name: 'Bone.025',
          suivant: ['Bone.026'],
          precedent: ['Bone.024'],
          id: 23,
          coordinates: [-277.36285400390625, 1407.0],
          tail: [-277.36285400390625],
          last: [22],
          next: [24],
          type: 'event',
        },
        {
          name: 'Bone.026',
          suivant: ['Bone.027'],
          precedent: ['Bone.025'],
          id: 24,
          coordinates: [-265.36285400390625, 1432.0],
          tail: [-265.36285400390625],
          last: [23],
          next: [25],
          type: 'house',
        },
        {
          name: 'Bone.027',
          suivant: ['Bone.028'],
          precedent: ['Bone.026'],
          id: 25,
          coordinates: [-200.3628387451172, 1446.0],
          tail: [-200.3628387451172],
          last: [24],
          next: [26],
          type: 'event',
        },
        {
          name: 'Bone.028',
          suivant: ['Bone.029', 'Bone.030'],
          precedent: ['Bone.027'],
          id: 26,
          coordinates: [-132.36280822753906, 1409.0001220703125],
          tail: [-132.36280822753906],
          last: [25],
          next: [27, 30],
          type: 'intersection',
        },
        {
          name: 'Bone.029',
          suivant: ['Bone.076'],
          precedent: ['Bone.028'],
          id: 27,
          coordinates: [-51.362831115722656, 1320.0001220703125],
          tail: [-51.362831115722656],
          last: [26],
          next: [28],
          type: 'event',
        },
        {
          name: 'Bone.076',
          suivant: ['Bone.077'],
          precedent: ['Bone.029'],
          id: 28,
          coordinates: [-11.362838745117188, 1272.0001220703125],
          tail: [-11.362838745117188],
          last: [27],
          next: [29],
          type: 'house',
        },
        {
          name: 'Bone.077',
          suivant: [],
          precedent: ['Bone.076'],
          id: 29,
          coordinates: [58.63715744018555, 1191.0001220703125],
          tail: [58.63715744018555],
          last: [28],
          next: [87],
          type: 'house',
        },
        {
          name: 'Bone.030',
          suivant: ['Bone.031'],
          precedent: ['Bone.028'],
          id: 30,
          coordinates: [-62.36280822753906, 1443.0],
          tail: [-62.36280822753906],
          last: [26],
          next: [31],
          type: 'house',
        },
        {
          name: 'Bone.031',
          suivant: ['Bone.032', 'Bone.040'],
          precedent: ['Bone.030'],
          id: 31,
          coordinates: [1.6371879577636719, 1472.0001220703125],
          tail: [1.6371879577636719],
          last: [30],
          next: [32, 70],
          type: 'intersection',
        },
        {
          name: 'Bone.032',
          suivant: ['Bone.033'],
          precedent: ['Bone.031'],
          id: 32,
          coordinates: [-15.362808227539062, 1512.000244140625],
          tail: [-15.362808227539062],
          last: [31],
          next: [33],
          type: 'house',
        },
        {
          name: 'Bone.033',
          suivant: ['Bone.034'],
          precedent: ['Bone.032'],
          id: 33,
          coordinates: [-55.36278533935547, 1598.000244140625],
          tail: [-55.36278533935547],
          last: [32],
          next: [34],
          type: 'event',
        },
        {
          name: 'Bone.034',
          suivant: ['Bone.035'],
          precedent: ['Bone.033'],
          id: 34,
          coordinates: [-82.3627700805664, 1657.000244140625],
          tail: [-82.3627700805664],
          last: [33],
          next: [35],
          type: 'event',
        },
        {
          name: 'Bone.035',
          suivant: ['Bone.036'],
          precedent: ['Bone.034'],
          id: 35,
          coordinates: [-37.362762451171875, 1664.0001220703125],
          tail: [-37.362762451171875],
          last: [34],
          next: [36],
          type: 'house',
        },
        {
          name: 'Bone.036',
          suivant: ['Bone.037'],
          precedent: ['Bone.035'],
          id: 36,
          coordinates: [99.63720703125, 1680.0001220703125],
          tail: [99.63720703125],
          last: [35],
          next: [37],
          type: 'house',
        },
        {
          name: 'Bone.037',
          suivant: ['Bone.038'],
          precedent: ['Bone.036'],
          id: 37,
          coordinates: [160.63720703125, 1687.0001220703125],
          tail: [160.63720703125],
          last: [36],
          next: [38],
          type: 'event',
        },
        {
          name: 'Bone.038',
          suivant: ['Bone.039'],
          precedent: ['Bone.037'],
          id: 38,
          coordinates: [197.63720703125, 1646.0001220703125],
          tail: [197.63720703125],
          last: [37],
          next: [39],
          type: 'house',
        },
        {
          name: 'Bone.039',
          suivant: ['Bone.044'],
          precedent: ['Bone.038'],
          id: 39,
          coordinates: [247.63722229003906, 1596.0001220703125],
          tail: [247.63722229003906],
          last: [38, 72, 92],
          next: [40],
          type: 'intersection',
        },
        {
          name: 'Bone.044',
          suivant: ['Bone.045'],
          precedent: ['Bone.039'],
          id: 40,
          coordinates: [297.63720703125, 1666.000244140625],
          tail: [297.63720703125],
          last: [39],
          next: [41],
          type: 'police',
        },
        {
          name: 'Bone.045',
          suivant: ['Bone.046'],
          precedent: ['Bone.044'],
          id: 41,
          coordinates: [396.63720703125, 1631.0],
          tail: [396.63720703125],
          last: [40],
          next: [42],
          type: 'house',
        },
        {
          name: 'Bone.046',
          suivant: ['Bone.047'],
          precedent: ['Bone.045'],
          id: 42,
          coordinates: [486.6372375488281, 1501.0001220703125],
          tail: [486.6372375488281],
          last: [41],
          next: [43],
          type: 'house',
        },
        {
          name: 'Bone.047',
          suivant: ['Bone.048'],
          precedent: ['Bone.046'],
          id: 43,
          coordinates: [531.63720703125, 1421.0],
          tail: [531.63720703125],
          last: [42],
          next: [44],
          type: 'event',
        },
        {
          name: 'Bone.048',
          suivant: ['Bone.049'],
          precedent: ['Bone.047'],
          id: 44,
          coordinates: [509.63726806640625, 1349.0001220703125],
          tail: [509.63726806640625],
          last: [43],
          next: [45],
          type: 'house',
        },
        {
          name: 'Bone.049',
          suivant: ['Bone.050'],
          precedent: ['Bone.048'],
          id: 45,
          coordinates: [543.63720703125, 1299.0001220703125],
          tail: [543.63720703125],
          last: [44],
          next: [46],
          type: 'event',
        },
        {
          name: 'Bone.050',
          suivant: ['Bone.051'],
          precedent: ['Bone.049'],
          id: 46,
          coordinates: [493.6372375488281, 1259.0001220703125],
          tail: [493.6372375488281],
          last: [45],
          next: [47],
          type: 'house',
        },
        {
          name: 'Bone.051',
          suivant: ['Bone.052', 'Bone.103'],
          precedent: ['Bone.050'],
          id: 47,
          coordinates: [443.63720703125, 1219.0],
          tail: [443.63720703125],
          last: [46],
          next: [48, 67],
          type: 'intersection',
        },
        {
          name: 'Bone.052',
          suivant: ['Bone.053'],
          precedent: ['Bone.051'],
          id: 48,
          coordinates: [509.63720703125, 1167.0],
          tail: [509.63720703125],
          last: [47],
          next: [49],
          type: 'house',
        },
        {
          name: 'Bone.053',
          suivant: ['Bone.054'],
          precedent: ['Bone.052'],
          id: 49,
          coordinates: [547.6372680664062, 1138.0],
          tail: [547.6372680664062],
          last: [48],
          next: [50],
          type: 'event',
        },
        {
          name: 'Bone.054',
          suivant: ['Bone.055'],
          precedent: ['Bone.053'],
          id: 50,
          coordinates: [612.63720703125, 1089.0],
          tail: [612.63720703125],
          last: [49],
          next: [51],
          type: 'house',
        },
        {
          name: 'Bone.055',
          suivant: ['Bone.056', 'Bone.064'],
          precedent: ['Bone.054'],
          id: 51,
          coordinates: [676.63720703125, 1037.0],
          tail: [676.63720703125],
          last: [50],
          next: [52, 58],
          type: 'intersection',
        },
        {
          name: 'Bone.056',
          suivant: ['Bone.057', 'Bone.058'],
          precedent: ['Bone.055'],
          id: 52,
          coordinates: [631.6372680664062, 975.0000610351562],
          tail: [631.6372680664062],
          last: [51],
          next: [53, 56],
          type: 'intersection',
        },
        {
          name: 'Bone.057',
          suivant: ['Bone.061'],
          precedent: ['Bone.056'],
          id: 53,
          coordinates: [654.63720703125, 946.0000610351562],
          tail: [654.63720703125],
          last: [52],
          next: [54],
          type: 'house',
        },
        {
          name: 'Bone.061',
          suivant: ['Bone.062'],
          precedent: ['Bone.057'],
          id: 54,
          coordinates: [659.63720703125, 911.0000610351562],
          tail: [659.63720703125],
          last: [53],
          next: [55],
          type: 'house',
        },
        {
          name: 'Bone.062',
          suivant: [],
          precedent: ['Bone.061'],
          id: 55,
          coordinates: [608.63720703125, 841.0000610351562],
          tail: [608.63720703125],
          last: [54, 57],
          next: [65],
          type: 'intersection',
        },
        {
          name: 'Bone.058',
          suivant: ['Bone.059'],
          precedent: ['Bone.056'],
          id: 56,
          coordinates: [589.63720703125, 906.0],
          tail: [589.63720703125],
          last: [52],
          next: [57],
          type: 'house',
        },
        {
          name: 'Bone.059',
          suivant: [],
          precedent: ['Bone.058'],
          id: 57,
          coordinates: [568.6372680664062, 862.0],
          tail: [568.6372680664062],
          last: [56, 69],
          next: [55],
          type: 'intersection',
        },
        {
          name: 'Bone.064',
          suivant: ['Bone.065'],
          precedent: ['Bone.055'],
          id: 58,
          coordinates: [710.63720703125, 1077.0],
          tail: [710.63720703125],
          last: [51],
          next: [59],
          type: 'event',
        },
        {
          name: 'Bone.065',
          suivant: ['Bone.066'],
          precedent: ['Bone.064'],
          id: 59,
          coordinates: [745.63720703125, 1129.0],
          tail: [745.63720703125],
          last: [58],
          next: [60],
          type: 'monuments',
        },
        {
          name: 'Bone.066',
          suivant: ['Bone.067'],
          precedent: ['Bone.065'],
          id: 60,
          coordinates: [847.63720703125, 1078.0001220703125],
          tail: [847.63720703125],
          last: [59],
          next: [61],
          type: 'house',
        },
        {
          name: 'Bone.067',
          suivant: ['Bone.068'],
          precedent: ['Bone.066'],
          id: 61,
          coordinates: [837.63720703125, 988.0000610351562],
          tail: [837.63720703125],
          last: [60],
          next: [62],
          type: 'event',
        },
        {
          name: 'Bone.068',
          suivant: ['Bone.069'],
          precedent: ['Bone.067'],
          id: 62,
          coordinates: [753.63720703125, 960.0000610351562],
          tail: [753.63720703125],
          last: [61],
          next: [63],
          type: 'event',
        },
        {
          name: 'Bone.069',
          suivant: ['Bone.070'],
          precedent: ['Bone.068'],
          id: 63,
          coordinates: [757.6372680664062, 905.0],
          tail: [757.6372680664062],
          last: [62],
          next: [64],
          type: 'house',
        },
        {
          name: 'Bone.070',
          suivant: ['Bone.071'],
          precedent: ['Bone.069'],
          id: 64,
          coordinates: [707.6372680664062, 795.0],
          tail: [707.6372680664062],
          last: [63],
          next: [65],
          type: 'event',
        },
        {
          name: 'Bone.071',
          suivant: ['Bone.072'],
          precedent: ['Bone.070'],
          id: 65,
          coordinates: [607.63720703125, 780.0001220703125],
          tail: [607.63720703125],
          last: [64, 55],
          next: [66],
          type: 'intersection',
        },
        {
          name: 'Bone.072',
          suivant: [],
          precedent: ['Bone.071'],
          id: 66,
          coordinates: [562.63720703125, 756.0],
          tail: [562.63720703125],
          last: [65],
          next: [0],
          type: 'house',
        },
        {
          name: 'Bone.103',
          suivant: ['Bone.104'],
          precedent: ['Bone.051'],
          id: 67,
          coordinates: [347.6372375488281, 1162.0001220703125],
          tail: [347.6372375488281],
          last: [47],
          next: [68],
          type: 'event',
        },
        {
          name: 'Bone.104',
          suivant: ['Bone.105'],
          precedent: ['Bone.103'],
          id: 68,
          coordinates: [417.63720703125, 1032.0],
          tail: [417.63720703125],
          last: [67],
          next: [69],
          type: 'house',
        },
        {
          name: 'Bone.105',
          suivant: [],
          precedent: ['Bone.104'],
          id: 69,
          coordinates: [487.63720703125, 932.0],
          tail: [487.63720703125],
          last: [68],
          next: [57],
          type: 'event',
        },
        {
          name: 'Bone.040',
          suivant: ['Bone.041'],
          precedent: ['Bone.031'],
          id: 70,
          coordinates: [54.63715744018555, 1497.0001220703125],
          tail: [54.63715744018555],
          last: [31],
          next: [71],
          type: 'house',
        },
        {
          name: 'Bone.041',
          suivant: ['Bone.042'],
          precedent: ['Bone.040'],
          id: 71,
          coordinates: [112.63715362548828, 1519.0001220703125],
          tail: [112.63715362548828],
          last: [70, 96],
          next: [72],
          type: 'event',
        },
        {
          name: 'Bone.042',
          suivant: [],
          precedent: ['Bone.041'],
          id: 72,
          coordinates: [211.6371612548828, 1543.0],
          tail: [211.6371612548828],
          last: [71],
          next: [39],
          type: 'house',
        },
        {
          name: 'Bone.021',
          suivant: ['Bone.075'],
          precedent: ['Bone.018'],
          id: 73,
          coordinates: [-52.36280059814453, 1073.0001220703125],
          tail: [-52.36280059814453],
          last: [18],
          next: [74],
          type: 'house',
        },
        {
          name: 'Bone.075',
          suivant: [],
          precedent: ['Bone.021'],
          id: 74,
          coordinates: [45.23721694946289, 1134.60009765625],
          tail: [45.23721694946289],
          last: [73],
          next: [87],
          type: 'event',
        },
        {
          name: 'Bone.019',
          suivant: ['Bone.073'],
          precedent: ['Bone.007'],
          id: 75,
          coordinates: [-10.362785339355469, 838.0001220703125],
          tail: [-10.362785339355469],
          last: [7],
          next: [76],
          type: 'house',
        },
        {
          name: 'Bone.073',
          suivant: [],
          precedent: ['Bone.019'],
          id: 76,
          coordinates: [-56.46277618408203, 939.4000854492188],
          tail: [-56.46277618408203],
          last: [75],
          next: [18],
          type: 'event',
        },
        {
          name: 'Bone.080',
          suivant: ['Bone.081'],
          precedent: ['Bone'],
          id: 77,
          coordinates: [513.63720703125, 750.0001220703125],
          tail: [513.63720703125],
          last: [0],
          next: [78],
          type: 'event',
        },
        {
          name: 'Bone.081',
          suivant: ['Bone.082'],
          precedent: ['Bone.080'],
          id: 78,
          coordinates: [403.6371765136719, 829.0001220703125],
          tail: [403.6371765136719],
          last: [77],
          next: [79],
          type: 'house',
        },
        {
          name: 'Bone.082',
          suivant: ['Bone.083'],
          precedent: ['Bone.081'],
          id: 79,
          coordinates: [328.6371765136719, 888.0001220703125],
          tail: [328.6371765136719],
          last: [78],
          next: [80],
          type: 'house',
        },
        {
          name: 'Bone.083',
          suivant: ['Bone.084', 'Bone.107'],
          precedent: ['Bone.082'],
          id: 80,
          coordinates: [296.6371765136719, 924.0001220703125],
          tail: [296.6371765136719],
          last: [79],
          next: [81, 98],
          type: 'intersection',
        },
        {
          name: 'Bone.084',
          suivant: ['Bone.085'],
          precedent: ['Bone.083'],
          id: 81,
          coordinates: [264.3371887207031, 904.900146484375],
          tail: [264.3371887207031],
          last: [80],
          next: [82],
          type: 'house',
        },
        {
          name: 'Bone.085',
          suivant: ['Bone.086', 'Bone.087'],
          precedent: ['Bone.084'],
          id: 82,
          coordinates: [241.63717651367188, 891.0000610351562],
          tail: [241.63717651367188],
          last: [81],
          next: [83, 97],
          type: 'intersection',
        },
        {
          name: 'Bone.086',
          suivant: ['Bone.088'],
          precedent: ['Bone.085'],
          id: 83,
          coordinates: [174.63717651367188, 948.0],
          tail: [174.63717651367188],
          last: [82],
          next: [84],
          type: 'house',
        },
        {
          name: 'Bone.088',
          suivant: ['Bone.089'],
          precedent: ['Bone.086'],
          id: 84,
          coordinates: [106.63716125488281, 1013.0000610351562],
          tail: [106.63716125488281],
          last: [83],
          next: [85],
          type: 'event',
        },
        {
          name: 'Bone.089',
          suivant: ['Bone.090'],
          precedent: ['Bone.088'],
          id: 85,
          coordinates: [141.6371612548828, 1032.0001220703125],
          tail: [141.6371612548828],
          last: [84],
          next: [86],
          type: 'house',
        },
        {
          name: 'Bone.090',
          suivant: ['Bone.091'],
          precedent: ['Bone.089'],
          id: 86,
          coordinates: [179.63717651367188, 1050.0],
          tail: [179.63717651367188],
          last: [85, 101],
          next: [87],
          type: 'intersection',
        },
        {
          name: 'Bone.091',
          suivant: ['Bone.092'],
          precedent: ['Bone.090'],
          id: 87,
          coordinates: [89.63713073730469, 1159.0],
          tail: [89.63713073730469],
          last: [86, 74, 29],
          next: [88],
          type: 'intersection',
        },
        {
          name: 'Bone.092',
          suivant: ['Bone.093', 'Bone.094'],
          precedent: ['Bone.091'],
          id: 88,
          coordinates: [185.6371307373047, 1217.0],
          tail: [185.6371307373047],
          last: [87],
          next: [89, 93],
          type: 'intersection',
        },
        {
          name: 'Bone.093',
          suivant: ['Bone.099'],
          precedent: ['Bone.092'],
          id: 89,
          coordinates: [218.63714599609375, 1234.0],
          tail: [218.63714599609375],
          last: [88],
          next: [90],
          type: 'monuments',
        },
        {
          name: 'Bone.099',
          suivant: ['Bone.100'],
          precedent: ['Bone.093'],
          id: 90,
          coordinates: [278.63714599609375, 1284.0],
          tail: [278.63714599609375],
          last: [89],
          next: [91],
          type: 'house',
        },
        {
          name: 'Bone.100',
          suivant: ['Bone.101'],
          precedent: ['Bone.099'],
          id: 91,
          coordinates: [304.63714599609375, 1304.0],
          tail: [304.63714599609375],
          last: [90],
          next: [92],
          type: 'event',
        },
        {
          name: 'Bone.101',
          suivant: [],
          precedent: ['Bone.100'],
          id: 92,
          coordinates: [282.6371154785156, 1427.0001220703125],
          tail: [282.6371154785156],
          last: [91],
          next: [39],
          type: 'event',
        },
        {
          name: 'Bone.094',
          suivant: ['Bone.095'],
          precedent: ['Bone.092'],
          id: 93,
          coordinates: [177.6371307373047, 1256.0],
          tail: [177.6371307373047],
          last: [88],
          next: [94],
          type: 'house',
        },
        {
          name: 'Bone.095',
          suivant: ['Bone.096'],
          precedent: ['Bone.094'],
          id: 94,
          coordinates: [167.63711547851562, 1298.0001220703125],
          tail: [167.63711547851562],
          last: [93],
          next: [95],
          type: 'event',
        },
        {
          name: 'Bone.096',
          suivant: ['Bone.097'],
          precedent: ['Bone.095'],
          id: 95,
          coordinates: [154.63711547851562, 1355.0],
          tail: [154.63711547851562],
          last: [94],
          next: [96],
          type: 'house',
        },
        {
          name: 'Bone.097',
          suivant: [],
          precedent: ['Bone.096'],
          id: 96,
          coordinates: [139.63711547851562, 1411.0001220703125],
          tail: [139.63711547851562],
          last: [95],
          next: [71],
          type: 'event',
        },
        {
          name: 'Bone.087',
          suivant: [],
          precedent: ['Bone.085'],
          id: 97,
          coordinates: [189.63719177246094, 851.0],
          tail: [189.63719177246094],
          last: [82],
          next: [5],
          type: 'house',
        },
        {
          name: 'Bone.107',
          suivant: ['Bone.108'],
          precedent: ['Bone.083'],
          id: 98,
          coordinates: [417.6371765136719, 991.0001220703125],
          tail: [417.6371765136719],
          last: [80],
          next: [99],
          type: 'event',
        },
        {
          name: 'Bone.108',
          suivant: ['Bone.109'],
          precedent: ['Bone.107'],
          id: 99,
          coordinates: [376.6371765136719, 1060.0001220703125],
          tail: [376.6371765136719],
          last: [98],
          next: [100],
          type: 'house',
        },
        {
          name: 'Bone.109',
          suivant: ['Bone.110'],
          precedent: ['Bone.108'],
          id: 100,
          coordinates: [322.6371765136719, 1145.0],
          tail: [322.6371765136719],
          last: [99],
          next: [101],
          type: 'event',
        },
        {
          name: 'Bone.110',
          suivant: [],
          precedent: ['Bone.109'],
          id: 101,
          coordinates: [236.63719177246094, 1084.0],
          tail: [236.63719177246094],
          last: [100],
          next: [86],
          type: 'house',
        },
      ],

      houses: [
        {
          objectName: 'map_75.osm_buildings',
          coordinates: [-56.256019592285156, 1708.04052734375],
          cases: [35],
          name: '',
        },
        {
          objectName: 'map_72.osm_buildings',
          coordinates: [124.67726135253906, 1628.83056640625],
          cases: [36, 38],
          name: '',
        },
        {
          objectName: 'map_66.osm_buildings',
          coordinates: [200.32469177246094, 1563.7718505859375],
          cases: [72],
          name: '',
        },
        {
          objectName: 'map_68.osm_buildings',
          coordinates: [29.61128044128418, 1520.263427734375],
          cases: [32, 70],
          name: '',
        },
        {
          objectName: 'map_82.osm_buildings',
          coordinates: [-219.20899963378906, 1413.407958984375],
          cases: [24],
          name: '',
        },
        {
          objectName: 'map_51.osm_buildings.001',
          coordinates: [264.6740417480469, 1316.7181396484375],
          cases: [90],
          name: '',
        },
        {
          objectName: 'map_61.osm_buildings',
          coordinates: [178.4031524658203, 1365.0673828125],
          cases: [95],
          name: '',
        },
        {
          objectName: 'map_63.osm_buildings',
          coordinates: [-37.75850296020508, 1394.3084716796875],
          cases: [30],
          name: '',
        },
        {
          objectName: 'map_60.osm_buildings',
          coordinates: [80.44779968261719, 1299.3583984375],
          cases: [28],
          name: '',
        },
        {
          objectName: 'map_53.osm_buildings',
          coordinates: [108.253662109375, 1227.74462890625],
          cases: [29, 93],
          name: '',
        },
        {
          objectName: 'map_57.osm_buildings',
          coordinates: [-289.45623779296875, 1265.518310546875],
          cases: [22],
          name: '',
        },
        {
          objectName: 'map_59.osm_buildings',
          coordinates: [-78.96746063232422, 1248.9517822265625],
          cases: [21],
          name: '',
        },
        {
          objectName: 'map_55.osm_buildings',
          coordinates: [-204.07420349121094, 1060.0189208984375],
          cases: [17, 19],
          name: '',
        },
        {
          objectName: 'map_101.osm_buildings',
          coordinates: [448.3746337890625, 1664.7923583984375],
          cases: [41],
          name: '',
        },
        {
          objectName: 'map_102.osm_buildings',
          coordinates: [509.22259521484375, 1553.8734130859375],
          cases: [42],
          name: '',
        },
        {
          objectName: 'map_46.osm_buildings.001',
          coordinates: [84.50054168701172, 1085.8468017578125],
          cases: [85],
          name: '',
        },
        {
          objectName: 'map_45.osm_buildings.001',
          coordinates: [-22.088947296142578, 1011.3082885742188],
          cases: [73],
          name: '',
        },
        {
          objectName: 'map_43.osm_buildings.001',
          coordinates: [-233.7200927734375, 914.2178955078125],
          cases: [15],
          name: '',
        },
        {
          objectName: 'map_38.osm_buildings.001',
          coordinates: [-77.28373718261719, 802.2394409179688],
          cases: [13, 75],
          name: '',
        },
        {
          objectName: 'map_36.osm_buildings.001',
          coordinates: [137.3153076171875, 920.9534301757812],
          cases: [83, 97],
          name: '',
        },
        {
          objectName: 'map_34.osm_buildings.001',
          coordinates: [287.5101013183594, 1047.707275390625],
          cases: [99, 101],
          name: '',
        },
        {
          objectName: 'map_12.osm_buildings',
          coordinates: [279.29638671875, 862.5297241210938],
          cases: [79, 81],
          name: '',
        },
        {
          objectName: 'map_13.osm_buildings.001',
          coordinates: [355.1412048339844, 827.757568359375],
          cases: [78],
          name: '',
        },
        {
          objectName: 'map_5.osm_buildings.001',
          coordinates: [122.8434066772461, 743.9796142578125],
          cases: [4, 6, 8],
          name: '',
        },
        {
          objectName: 'map_3.osm_buildings',
          coordinates: [194.30792236328125, 689.5978393554688],
          cases: [3],
          name: '',
        },
        {
          objectName: 'map_6.osm_buildings',
          coordinates: [40.65419387817383, 634.1316528320312],
          cases: [9],
          name: '',
        },
        {
          objectName: 'map_36.osm_buildings',
          coordinates: [450.7852478027344, 706.0155639648438],
          cases: [1],
          name: '',
        },
        {
          objectName: 'map_23.osm_buildings.001',
          coordinates: [579.23583984375, 816.7730102539062],
          cases: [66],
          name: '',
        },
        {
          objectName: 'map_86.osm_buildings',
          coordinates: [686.5042114257812, 920.12939453125],
          cases: [63],
          name: '',
        },
        {
          objectName: 'map_26.osm_buildings.001',
          coordinates: [627.8701171875, 931.1934814453125],
          cases: [53, 54],
          name: '',
        },
        {
          objectName: 'map_89.osm_buildings',
          coordinates: [896.46875, 1000.8516845703125],
          cases: [60],
          name: '',
        },
        {
          objectName: 'map_92.osm_buildings',
          coordinates: [586.111572265625, 1048.250732421875],
          cases: [50],
          name: '',
        },
        {
          objectName: 'map_95.osm_buildings',
          coordinates: [475.4784240722656, 1147.645263671875],
          cases: [48],
          name: '',
        },
        {
          objectName: 'map_93.osm_buildings',
          coordinates: [443.53118896484375, 1070.333251953125],
          cases: [68],
          name: '',
        },
        {
          objectName: 'map_90.osm_buildings',
          coordinates: [583.0365600585938, 940.1422119140625],
          cases: [56],
          name: '',
        },
        {
          objectName: 'map_98.osm_buildings',
          coordinates: [417.39617919921875, 1272.17041015625],
          cases: [44, 46],
          name: '',
        },
      ],

      monuments: [
        {
          objectName: 'halle_aux_sucres',
          coordinates: [221.27859497070312, 1193.7264404296875],
          cases: [89],
          name: 'halle_aux_sucres',
        },
        {
          objectName: 'treille',
          coordinates: [395.8026428222656, 746.2998046875],
          cases: [2],
          name: 'treille',
        },
        {
          objectName: 'stCatherine',
          coordinates: [-21.4647216796875, 654.5323486328125],
          cases: [11],
          name: 'stCatherine',
        },
        {
          objectName: 'porte_gand',
          coordinates: [755.0357666015625, 1147.999267578125],
          cases: [59],
          name: 'porte_gand',
        },
      ],
    };

    return await this.mapModel.create({
      cases: map.cases,
      houses: map.houses,
      monuments: map.monuments,
      configuration: {
        name: 'Default',
        description: 'Default configuration',
        salary: 200,
        ratingMultiplicator: [0.8, 1.2],
        bank: { tax: 0.1, value: 1000 },
        diplomeBonus: 50000,
        maxPlayer: 4,
        minPlayer: 2,
        starting: { money: 1000, rating: 1000 },
        defectRate: { fire: 0.1, water: 0.1, electricity: 0.1 },
        parkRatingBonus: 1,
        price: 1000,
        playerRange: 3,
        auctionStepPourcent: 10,
      },
    });
  }

  async findOne(mapId: string) {
    return await this.mapModel.findById(mapId);
  }

  async findAll() {
    return await this.mapModel.find();
  }

  /**
   * Get accessible cases from a player position for a specific map.
   * @param map
   * @param playerPosition
   * @returns
   */
  getNearestCases(map: Doc<Map>, playerPosition: number): number[] {
    const cases = map.cases;
    const nearestCases = [playerPosition];
    let next = cases[playerPosition].next;
    let last = cases[playerPosition].last;

    for (let i = 0; i < map.configuration.playerRange; i++) {
      nearestCases.push(...next);
      nearestCases.push(...last);
      const newNext = [];
      const newLast = [];
      for (let j = 0; j < next.length; j++) {
        newNext.push(...cases[next[j]].next);
      }
      for (let j = 0; j < last.length; j++) {
        newLast.push(...cases[last[j]].last);
      }
      next = newNext;
      last = newLast;
    }
    return nearestCases;
  }

  /**
   * Get random event from the map configuration.
   */
  getRandomEvent(): CaseEventType {
    const random = Math.random();
    const events = CaseEvent;
    let sum = 0;
    for (const event of events) {
      sum += event.dropRate;
      if (random < sum) {
        return event.code;
      }
    }
    return null;
  }

  gambleCasino(player: Doc<Player>, map: Doc<Map>) {
    const random = Math.random();
    const events = CaseEvent;
    let sum = 0;
    for (const event of events) {
      sum += event.dropRate;
      if (random < sum) {
        return event.code;
      }
    }
    return null;
  }
}
